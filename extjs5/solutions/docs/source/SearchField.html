<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define(&#39;Ext.ux.form.SearchField&#39;, {
    extend: &#39;Ext.form.field.Text&#39;,

    alias: &#39;widget.searchfield&#39;,

    triggers: {
        clear: {
            weight: 0,
            cls: Ext.baseCSSPrefix + &#39;form-clear-trigger&#39;,
            hidden: true,
            handler: &#39;onClearClick&#39;,
            scope: &#39;this&#39;
        },
        search: {
            weight: 1,
            cls: Ext.baseCSSPrefix + &#39;form-search-trigger&#39;,
            handler: &#39;onSearchClick&#39;,
            scope: &#39;this&#39;
        }
    },

    hasSearch : false,
    paramName : &#39;query&#39;,

    initComponent: function() {
        var me = this,
            store = me.store,
            proxy;

        me.callParent(arguments);
        me.on(&#39;specialkey&#39;, function(f, e){
            if (e.getKey() == e.ENTER) {
                me.onSearchClick();
            }
        });
        
        if (!store || !store.isStore) {
            store = me.store = Ext.data.StoreManager.lookup(store);
        }

        // We&#39;re going to use filtering
        store.setRemoteFilter(true);

        // Set up the proxy to encode the filter in the simplest way as a name/value pair
        proxy = me.store.getProxy();
        proxy.setFilterParam(me.paramName);
        proxy.encodeFilters = function(filters) {
            return filters[0].getValue();
        }
    },

    onClearClick : function(){
        var me = this,
            activeFilter = me.activeFilter;

        if (activeFilter) {
            me.setValue(&#39;&#39;);
            me.store.getFilters().remove(activeFilter);
            me.activeFilter = null;
            me.getTrigger(&#39;clear&#39;).hide();
            me.updateLayout();
        }
    },

    onSearchClick : function(){
        var me = this,
            value = me.getValue();

        if (value.length &gt; 0) {
            // Param name is ignored here since we use custom encoding in the proxy.
            // id is used by the Store to replace any previous filter
            me.activeFilter = new Ext.util.Filter({
                property: me.paramName,
                value: value
            });
            me.store.getFilters().add(me.activeFilter);
            me.getTrigger(&#39;clear&#39;).show();
            me.updateLayout();
        }
    }
});</pre>
</body>
</html>
